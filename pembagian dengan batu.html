<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Pecahan dengan Batu - Animasi</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .box {
      width: 90px; height: 90px;
      border: 2px solid #6c757d;
      border-radius: 6px;
      display: flex; flex-wrap: wrap;
      align-content: flex-start; justify-content: flex-start;
      padding: 4px; margin: 4px;
      background: #f8f9fa;
      position: relative;
      transition: background 0.3s ease;
    }
    .stone {
      width: 22px; height: 22px;
      border-radius: 50%;
      margin: 2px;
      background: radial-gradient(circle at 30% 25%, #fff, #0d6efd);
      color: #fff; font-size: 0.7rem; font-weight: bold;
      display: flex; align-items: center; justify-content: center;
    }
    .label {
      position: absolute; bottom: 2px; right: 4px;
      font-size: 0.7rem; color: #495057;
    }
    .fraction {
      display: inline-block;
      text-align: center;
      vertical-align: middle;
    }
    .fraction .top {
      display: block;
      border-bottom: 2px solid #000;
      font-size: 1.2rem;
      line-height: 1.4;
    }
    .fraction .bottom {
      display: block;
      font-size: 1.2rem;
      line-height: 1.4;
    }
  </style>
</head>
<body class="bg-light">
<div class="container py-4">
  <h4>Visualisasi Pecahan dengan Batu (Animasi)</h4>
  <p>Kotak = penyebut, jumlah batu = pembilang (diisi berurutan dari kiri).</p>

  <div class="row g-3 align-items-center">
    <div class="col-md-4">
      <label class="form-label">Pembilang</label>
      <input id="num" type="range" class="form-range" value="7" min="0" max="50">
      <span id="numVal">7</span>
    </div>
    <div class="col-md-4">
      <label class="form-label">Penyebut</label>
      <input id="den" type="range" class="form-range" value="5" min="1" max="12">
      <span id="denVal">5</span>
    </div>
    <div class="col-md-4">
      <button id="playBtn" class="btn btn-primary mt-3">▶ Play</button>
      <button id="resetBtn" class="btn btn-secondary mt-3">⟳ Reset</button>
    </div>
  </div>

  <div class="mt-4">
    <h5>Pecahan Target:</h5>
    <p>
      <span id="fractionLabel"></span>
      <span id="mixedLabel" class="ms-3 text-primary"></span>
    </p>

    <h5>Indikator Animasi:</h5>
    <p>
      <span id="animFraction" class="fw-bold text-success"></span>
    </p>

    <div id="boxes" class="d-flex flex-wrap"></div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
let intervalId = null;
let currentStone = 0;
let maxStone = 0;
let denom = 1;

function makeStone(num){
  return $('<div class="stone">'+num+'</div>');
}

function formatFraction(n,d){
  if(n < d){
    return '<span class="fraction"><span class="top">'+n+'</span><span class="bottom">'+d+'</span></span>';
  } else {
    let whole = Math.floor(n/d);
    let remainder = n % d;
    if(remainder === 0){
      return whole.toString();
    } else {
      return whole + ' <span class="fraction"><span class="top">'+remainder+'</span><span class="bottom">'+d+'</span></span>';
    }
  }
}

function updateFraction(n,d){
  $('#fractionLabel').html(
    '<span class="fraction"><span class="top">'+n+'</span><span class="bottom">'+d+'</span></span>'
  );
  if(n >= d){
    $('#mixedLabel').html('= ' + formatFraction(n,d));
  } else {
    $('#mixedLabel').text('');
  }
}

function renderBoxes(d){
  let $boxes = $('#boxes').empty();
  for(let i=1;i<=d;i++){
    let $box = $('<div class="box"></div>');
    $box.append('<div class="label">Kotak '+i+'</div>');
    $boxes.append($box);
  }
}

function updateBoxColors(){
  $('#boxes .box').each(function(){
    let stoneCount = $(this).find('.stone').length;
    if(stoneCount === 0){
      $(this).css('background','#f8f9fa');
    } else if(stoneCount % 2 === 0){
      $(this).css('background','cyan');
    } else {
      $(this).css('background','pink');
    }
  });
}

function startAnimation(n,d){
  clearInterval(intervalId);
  currentStone = 0;
  maxStone = n;
  denom = d;
  renderBoxes(d);
  updateFraction(n,d);
  updateBoxColors();
  $('#animFraction').html(formatFraction(0,d)); // mulai dari 0/d

  intervalId = setInterval(()=>{
    if(currentStone >= maxStone){
      clearInterval(intervalId);
      $('#playBtn').text('▶ Play');
      return;
    }
    let targetBox = (currentStone % d);
    $('#boxes .box').eq(targetBox).append(makeStone(currentStone+1));
    currentStone++;
    updateBoxColors();
    $('#animFraction').html(formatFraction(currentStone,d));
  },400);
}

$('#num').on('input',function(){
  $('#numVal').text($(this).val());
  render();
});
$('#den').on('input',function(){
  $('#denVal').text($(this).val());
  render();
});

function render(){
  clearInterval(intervalId);
  $('#playBtn').text('▶ Play');
  currentStone = 0;
  let n = parseInt($('#num').val()) || 0;
  let d = parseInt($('#den').val()) || 1;
  updateFraction(n,d);
  renderBoxes(d);
  updateBoxColors();
  $('#animFraction').html(formatFraction(0,d));
}

$('#playBtn').on('click',function(){
  let n = parseInt($('#num').val()) || 0;
  let d = parseInt($('#den').val()) || 1;
  if(intervalId){
    clearInterval(intervalId);
    intervalId = null;
    $(this).text('▶ Play');
  } else {
    $(this).text('⏸ Pause');
    startAnimation(n,d);
  }
});

$('#resetBtn').on('click',render);

render();
</script>
</body>
</html>
