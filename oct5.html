<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pecahan Pizza 3 Tahap</title>

  <!-- Bootstrap + Bootswatch -->
  <link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.3/dist/flatly/bootstrap.min.css" rel="stylesheet">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>

  <!-- Animate.css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"/>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">

  <style>
    body { background: #fffaf5; font-family: 'Fredoka One', cursive; }
    h1 { color: #e74c3c; }
    .pizza-box {
      text-align: center;
      margin: 20px;
      padding: 15px;
      border-radius: 20px;
      background: #ffffff;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .pizza-chart {
      position: relative;
      width: 180px;
      height: 180px;
      margin: auto;
    }
    .pizza-img {
      position: absolute;
      width: 100%; height: 100%;
      top: 0; left: 0;
      border-radius: 50%;
      opacity: 0.7;
    }
    canvas { position: absolute; top: 0; left: 0; width: 100% !important; height: 100% !important; }
    .btn-custom {
      transition: transform 0.2s ease;
    }
    .btn-custom:hover {
      transform: scale(1.1);
    }
  </style>
</head>
<body>
  <div class="container text-center py-4">
    <h1 class="animate__animated animate__bounce">üçï Pecahan Pizza: 3 Tahap</h1>
    <p class="text-muted">Visualisasi penjumlahan dan pengurangan pecahan dengan pizza</p>

    <!-- Input Pecahan -->
    <div class="row justify-content-center mb-4">
      <div class="col-md-3 card p-3 shadow-sm">
        <h5 class="text-success"><i class="fa-solid fa-pizza-slice"></i> Pecahan A</h5>
        <label>Pembilang:</label>
        <input type="number" class="form-control" id="num1" value="1" min="0">
        <label>Penyebut:</label>
        <input type="number" class="form-control" id="den1" value="4" min="1">
      </div>
      <div class="col-md-3 card p-3 shadow-sm">
        <h5 class="text-danger"><i class="fa-solid fa-pizza-slice"></i> Pecahan B</h5>
        <label>Pembilang:</label>
        <input type="number" class="form-control" id="num2" value="1" min="0">
        <label>Penyebut:</label>
        <input type="number" class="form-control" id="den2" value="3" min="1">
      </div>
    </div>

    <!-- Tombol -->
    <div class="mb-4">
      <button class="btn btn-success btn-lg m-2 btn-custom" onclick="hitung('tambah')">
        <i class="fa-solid fa-plus"></i> Tambah
      </button>
      <button class="btn btn-danger btn-lg m-2 btn-custom" onclick="hitung('kurang')">
        <i class="fa-solid fa-minus"></i> Kurang
      </button>
    </div>

    <!-- Layout 3 Kolom -->
    <div class="row justify-content-center align-items-center text-center">
      <!-- Tahap 1 -->
      <div class="col-md-3 pizza-box animate__animated animate__fadeInLeft">
        <h5 class="text-success">Tahap 1: Pizza Awal</h5>
        <div class="row align-items-center">
          <!-- Pizza A -->
          <div class="col-auto">
            <div class="pizza-chart mb-2">
              <img src="https://i.ibb.co/k21q7rX/pizza.png" class="pizza-img">
              <canvas id="pizzaAwalA"></canvas>
            </div>
            <p id="labelAwalA"></p>
          </div>

          <!-- Operator (+/-) -->
          <div class="col-auto">
            <h2 id="operatorAwal" class="mx-2 text-primary">+</h2>
          </div>

          <!-- Pizza B -->
          <div class="col-auto">
            <div class="pizza-chart mb-2">
              <img src="https://i.ibb.co/k21q7rX/pizza.png" class="pizza-img">
              <canvas id="pizzaAwalB"></canvas>
            </div>
            <p id="labelAwalB"></p>
          </div>
        </div>
      </div>

      <!-- Panah 1 -->
      <div class="col-auto">
        <i class="fa-solid fa-arrow-right fa-2x text-primary"></i>
      </div>

<!-- Tahap 2 -->
<div class="col-md-3 pizza-box animate__animated animate__fadeInUp">
  <h5 class="text-warning">Tahap 2: Samakan Penyebut</h5>
  <div class="row align-items-center">
    <!-- Pizza KPK A -->
    <div class="col-auto">
      <div class="pizza-chart mb-2">
        <img src="https://i.ibb.co/k21q7rX/pizza.png" class="pizza-img">
        <canvas id="pizzaKpkA"></canvas>
      </div>
      <p id="labelKpkA"></p>
    </div>

    <!-- Operator -->
    <div class="col-auto">
      <h2 id="operatorKpk" class="mx-2 text-primary">+</h2>
    </div>

    <!-- Pizza KPK B -->
    <div class="col-auto">
      <div class="pizza-chart mb-2">
        <img src="https://i.ibb.co/k21q7rX/pizza.png" class="pizza-img">
        <canvas id="pizzaKpkB"></canvas>
      </div>
      <p id="labelKpkB"></p>
    </div>
  </div>
</div>

      <!-- Panah 2 -->
      <div class="col-auto">
        <i class="fa-solid fa-arrow-right fa-2x text-primary"></i>
      </div>

      <!-- Tahap 3 -->
      <div class="col-md-3 pizza-box animate__animated animate__fadeInRight">
        <h5 class="text-primary">Tahap 3: Hasil</h5>
        <div class="pizza-chart">
          <img src="https://i.ibb.co/k21q7rX/pizza.png" class="pizza-img">
          <canvas id="pizzaHasil"></canvas>
        </div>
        <p id="labelHasil"></p>
        <h4 id="hasilText" class="mt-3 text-primary"></h4>
      </div>
    </div>
  </div>

  <script>
    let chartAwalA, chartAwalB, chartKpkA, chartKpkB, chartHasil;

    function fpb(a, b) { return b ? fpb(b, a % b) : a; }

    function buatPizza(canvasId, num, den) {
      let ctx = document.getElementById(canvasId).getContext("2d");
      let data = Array(den).fill(1);
      let colors = [];
      for (let i = 0; i < den; i++) {
        if (i < num) colors.push("rgba(231, 76, 60, 0.9)");
        else colors.push("rgba(189, 195, 199,0.4)");
      }
      return new Chart(ctx, {
        type: 'pie',
        data: { datasets: [{ data: data, backgroundColor: colors, borderColor: "#fff", borderWidth: 2 }] },
        options: {
          plugins: {
            legend: { display: false },
            datalabels: {
              color: '#fff',
              font: { weight: 'bold' },
              formatter: (value, ctx) => ctx.dataIndex + 1
            }
          }
        },
        plugins: [ChartDataLabels]
      });
    }

    function hitung(mode) {
      let num1 = parseInt(document.getElementById("num1").value);
      let den1 = parseInt(document.getElementById("den1").value);
      let num2 = parseInt(document.getElementById("num2").value);
      let den2 = parseInt(document.getElementById("den2").value);

      if (chartAwalA) chartAwalA.destroy();
      if (chartAwalB) chartAwalB.destroy();
      chartAwalA = buatPizza("pizzaAwalA", num1, den1);
      chartAwalB = buatPizza("pizzaAwalB", num2, den2);
      document.getElementById("labelAwalA").innerText = `= ${num1}/${den1}`;
      document.getElementById("labelAwalB").innerText = `= ${num2}/${den2}`;

      // ubah tanda operator
		document.getElementById("operatorAwal").innerText = (mode === "tambah") ? "+" : "-";
		document.getElementById("operatorKpk").innerText  = (mode === "tambah") ? "+" : "-";

      let kpk = (den1 * den2) / fpb(den1, den2);
      let n1 = num1 * (kpk / den1);
      let n2 = num2 * (kpk / den2);

      if (chartKpkA) chartKpkA.destroy();
      if (chartKpkB) chartKpkB.destroy();
      chartKpkA = buatPizza("pizzaKpkA", n1, kpk);
      chartKpkB = buatPizza("pizzaKpkB", n2, kpk);
      document.getElementById("labelKpkA").innerText = `= ${n1}/${kpk}`;
      document.getElementById("labelKpkB").innerText = `= ${n2}/${kpk}`;

      let pembilang = (mode === "tambah") ? (n1 + n2) : (n1 - n2);
      let penyebut = kpk;
      let d = fpb(Math.abs(pembilang), penyebut);
      pembilang /= d; penyebut /= d;

      if (chartHasil) chartHasil.destroy();
      chartHasil = buatPizza("pizzaHasil", pembilang, penyebut);
      document.getElementById("labelHasil").innerText = `= ${pembilang}/${penyebut}`;
      document.getElementById("hasilText").innerText = `Hasil Operasi = ${pembilang}/${penyebut}`;
    }

    hitung("tambah");
  </script>
</body>
</html>
